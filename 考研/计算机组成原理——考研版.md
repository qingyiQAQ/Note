# 第一章 计算机系统概述

## 计算机发展历程

1、硬件

第一代——电子管

第二代——晶体管

第三代——中小规模集成电路

第四代——超大规模集成电路

## 计算机系统层次结构

1、组成：**硬件**系统与**软件**系统共同组成一个完整的计算机系统

2、计算机硬件

冯诺依曼机基本思想
工作方式：**存储程序**
硬件系统组成：运算器、存储器、控制器、输入设备、输出设备
指令和数据存储在存储器中，存储形式没有区别
指令和数据均由二进制代码表示，指令由操作码和地址码组成

计算机功能部件：

(1)输入设备

(2)输出设备

(3)存储器
分为主存储器（内存）和辅助存储器（外存）
主存使用按地址的存取方式
地址寄存器MAR存放访问地址
数据寄存器MDR存放读取的数据
MAR、MDR、Cache都在CPU中

(4)运算器
核心是算术逻辑单元ALU
还含有累加器ACC、乘商寄存器MQ、操作寄存器X、变址寄存器IX、基址寄存器BR，前三个为必须
PSW标志寄存器，存放处理机状态信息

(5)控制器
由程序计数器PC、指令寄存器IR、控制单元CU组成
PC来自MAR、IR来自MDR
指令中操作码OP送至CU、地址码Ad(IR)送往MAR取操作数

CPU=运算器+控制器
包含ALU、GPRs（通用寄存器组）、标志寄存器PSW、控制器、指令寄存器IR、程序计数器PC、MAR、MDR

![image-20240315145747156](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20240315145747156.png)

CPU与主存之间通过一条总线相连

总线中有：地址、控制、数据3条

3、计算机软件

系统软件：操作系统OS，数据库管理系统DBMS、语言处理程序、分布式软件、网络软件、标准库等

应用软件：...

3个级别语言：机器语言、汇编语言、高级语言

3种翻译程序：汇编程序（汇编->机器）、解释程序（高级->机器，翻译一句执行一句）、编译程序（高级->机器，一次翻译成目标文件）

逻辑功能等价：某功能既可以由硬件实现也可以由软件实现

4、计算机系统的层次结构

微程序机器层->传统机器语言层->操作系统层->汇编语言层->高级语言层->应用程序层

前3层硬件，后3层软件

软硬件交界面：指令集体系结构ISA

5、工作原理

根据PC取指令->指令译码PC+1->取操作数并执行->送结果

hello.c->预处理器cpp->hello.i->编译器ccl->hello.s->汇编器as->hello.o+printf.o可重定位目标程序（二进制）->链接器Id->hello可执行目标程序（二进制）

程序执行过程：

(1)取指令：PC->MAR->M->MDR->IR

(2)分析指令：OP(IR)->CU

(3)执行指令：Ad(IR)->MAR->M->MDR->ACC

## 计算机性能指标

1、主要性能指标

(1)字长：一次整数运算能处理的二进制数据位数，为字节(B)的倍数

(2)数据通路带宽：数据总线一次能传送信息的位数

(3)主存容量：主存储器的最大容量，以字节来衡量，或者字数*字长

(4)运算速度：

吞吐量：单位时间内处理请求的数量，主要取决于主存的存储周期

响应时间：用户向计算机发出一个请求到获得结果的时间，包括CPU运行的时间和等待时间

CPU时间周期（节拍脉冲/T周期）：CPU最小时间单位，执行指令的每个动作需要一个CPU时间周期，主频的倒数

主频（CPU时间频率）：主时钟的频率

CPI（Cycle Per Instruction）：执行一条指令需要的时钟周期数

CPU执行时间=指令条数*CPI/主频

MIPS（Million Instruction Per Second）：每秒百万条指令，MIPS=指令条数/(执行时间*10^6^)=主频/(CPI**10^6^)

MFLOPS：每秒百万次浮点数运算

# 第二章 数据表示和计算

## 数制与编码

1、真值和机器数

真值：“+”、“-”表示正负

机器数：0表示正，1表示负

2、定点数的编码表示

通常用**定点补码整数**表示整数

(1)机器数的定点表示：

定点小数：约定小数点在符号位之后有效数值之前，X=x~0~x~1~x~2~...x~n~，x0为符号位，后面是有效数值

定点整数：约定小数点在有效数值之后符号位之前，X=x~0~x~1~x~2~...x~n~，x0为符号位，后面是有效数值

(2)原码、补码、反码、移码

**原码**：符号由01表示，其他不变，表示范围：-(2^n^-1)<=x<=2^n^-1，零有0,0000和1,0000两种表示

**补码**：

原码->补码：正数不变，负数符号不变，其余位取反+1

补码->原码：符号为为0不变，符号为为1，其余位取反+1

[x]补(小数)=
x,					0<=x<=1
2+x=2-|x|		-1<=x<0

[x]补(整数)=
0,x,				0<=x<2^n^
2^n+1^+x=2^n+1^-|x|	-2^n^<=x<0

表示范围：-2^n^<=x<=2^n^-1

零的表示唯一：0,0000

**反码**：正数不变，负数取反

0的表示不唯一

**移码**：在真值x上加上一个常数2^n^，n为字长减1

为补码的符号位取反

零的表示唯一：1,0000

表示范围：-2^n^<=x<=2^n^-1

3、整数的表示

(1)无符号整数：全部二进制数都是数值位

(2)带符号整数：符号位为第一位，后面是数值位，用补码表示

## 运算方法和运算电路

1、基本运算部件

加法器是ALU的核心部件

(1)一位全加器FA

和表达式：S~i~=A~i~⊕B~i~⊕C~i-1~
进位表达式：C~i~=A~i~B~i~⊕(A~i~⊕B~i~)C~i-1~

(2)串行进位加法器

n个全加器相连得到n位加法器

(3)并行进位加法器

进位产生函数G~i~=A~i~B~i~

进位传递函数Pi=A~i~⊕B~i~

先行进位部件CLA

![image-20240403150930145](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20240403150930145.png)

(4)带标志加法器

溢出标志OF=C~n~⊕C~n-1~，表示带符号整数运算时发生溢出，对于无符号数无意义

符号标志SF=F~n-1~（和的最高位），对于无符号数无意义

零标志ZF=1仅当F=0（和为0），对于两者都有意义

进位/借位标志CF=C~out~⊕C~in~，表示无符号数运算的进位/借位，对于带符号数没有意义

(5)算术逻辑单元ALU

输入：n位操作数A、B，进位输入端C~in~，操作控制端ALU~op~

输出：ZF、OF、SF、CF、n位结果F

2、定点数的移位运算

(1)算术移位

移位对象是有符号数，符号位不变

|      |       码制       |     添补代码     |
| :--: | :--------------: | :--------------: |
| 正数 | 原码、反码、补码 |        0         |
|      |       原码       |        0         |
| 负数 |       补码       | 左移添0，右移添1 |
|      |       反码       |        1         |

(2)逻辑移位

操作数为无符号数

左移右移都添0

(3)循环移位

分为带进位标志位CF的循环移位（大循环）和不带进位标志位的循环移位（小循环）

![image-20240403155338593](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20240403155338593.png)

3、定点数的加减运算

(1)补码的加减法运算

[A+B]~补~=[A]~补~+[B]~补~(mod 2^n+1^)

[A-B]~补~=[A]~补~+[-B]~补~(mod 2^n+1^)

(2)补码的加减运算电路

设置控制端Sub，Sub为0做加法，Sub为1做减法

Sub为1时Y先取反变成-Y再参与运算

CF=Sub⊕C~out~

(3)溢出判别方法

方法一：采用一位符号位：

设A的符号位为S~A~，B的符号位为S~B~，运算结果的符号位为S~S~

![image-20240406161722159](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20240406161722159.png)

V=0无溢出，V=1有溢出

方法二：采用双符号位（模4补码）：

设结果的两个符号位为S~S1~和S~S2~

V=S~S1~⊕S~S2~

V=0无溢出，V=1有溢出

方法三：采用一位符号位根据数据位进位情况判断溢出

符号位进位C~S~与最高数位进位C~1~相同则无溢出，否则有溢出

V=C~S~⊕C~1~

V=0无溢出，V=1有溢出

4、定点数的乘除运算

(1)定点数的乘法运算

原码一位乘法：

设[x]~原~=x~s~x~1~x~2~...x~n~，[y]~原~=y~s~y~1~y~2~...y~n~

被乘数与乘数都取绝对值参加运算，视作无符号数，符号位为x~s~⊕y~s~

部分积初值为0，从乘数最低位y~n~开始判断：若y~n~=1，则部分积加上被乘数|x|，右移一位；若y~n~=0，则部分积加上0，右移一位。重复n次。

(2)无符号数乘法运算电路

## 更新中

# 第三章 存储系统

## 3.1存储器概述

### 1、分类

（1）按层次

主存储器：主存CPU，随机存取

高速缓冲存储器：Cache

辅助存储器：外存

（2）存储介质

半导体存储器（主存、cache）、磁表面存储器（磁盘、磁带）、光存储器（光盘）

（3）存取方式

随机存取存储器RAM：存取时间与存储单元**物理位置无关**（主存、cache）

只读存取存储器ROM：**只能读不能写**，断电不丢失

串行存取存储器：按**物理位置先后**存取，分为顺序存取存储器SAM（磁带）、直接存取存储器DAM（速度大于SAM小于RAM）（磁盘、光盘）

相联存储器CAM：**按内容访问**（快表）

（4）信息的可更改性

读写存储器RWM（磁盘、内存、Cache）

只读存储器ROM（光盘CD-ROM、BIOS）

（5）信息的可保存性

易失性存储器：断点**信息消失**（主存，cache）

非易失性存储器：断电信息还在（磁盘、光盘）

破坏性读出：信息读出后被**破坏**（DRAM）

非破坏性读出：信息读出后不被破坏（SRAM，磁盘，光盘）

### 2、存储器性能指标

（1）存储容量：存储字数*字长

MAR反映存储字数

MDR反映存储字长

（2）单位成本：总成本/总容量

（3）存储速度：数据宽度/**存储周期**

存取时间Ta：一次存取操作的时间

存取周期Tm：两次存取的间隔，一般>Ta

主存带宽Bm=存储速度=数据宽度/存储周期，单位：B/s、b/s

## 3.2主存储器

### 1、SRAM芯片和DRAM芯片

SRAM静态RAM

DRAM动态RAM

**地址复用**->**只需要一半地址线**

|            | SRAM   | DRAM |
| ---------- | ------ | ---- |
| 主要用途   | cache  | 主存 |
| 存储信息   | 触发器 | 电容 |
| 破坏性读出 | 否     | 是   |
| 需要刷新   | 否     | 是   |
| 地址复用   | 否     | 是   |
| 运行速度   | 快     | 满   |
| 集成度     | 低     | 高   |
| 存储成本   | 高     | 低   |
| 易失性     | 是     | 是   |

DRAM刷新操作：

刷新周期：1-2ms

刷新单位：**行**

（1）集中刷新

刷新期间**所有区域**停止读写操作，成为“死时间”/“死区”

（2）分散刷新

每个存取周期后再用一个存取周期刷新，**没有死区**

（3）异步刷新

刷新间隔t=刷新周期/行数

### 2、只读存储器

非易失：数据**不会丢失**

（1）**MROM，**掩模式只读存储器

生产过程中写入，**任何人无法改变内容**

（2）**PROM，**可编程只读存储器

**写一次后不可更改**

（3）**EPROM**，可擦除可编程只读存储器

**可多次重写**，一次全部擦除

EEPROM，电擦除，可以擦除特定的字

（4）**Flash**，闪存

**可多次快速擦除重写**，如：U盘，SD卡

写比读更慢

（5）SSD，固态硬盘

**可多次擦除重写**

控制单元+闪存芯片

### 3、多模块存储器

（1）单体多字处理器

每个存储体存m个字，一次**并行读出**m个字

（2）多体并行存储器

高位交叉编址：高位地址为体号，低位为体内地址

**一次读出模m相同的全部地址**

低位交叉编址（默认）：低位地址为体号，高位为体内地址

**一次读出m个相邻地址**

![image-20240905141540404](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20240905141540404.png)

存取周期T，存取时间t，要求**T<=mt或者m>=T/r**，一般取=

读n个连续地址，低位交叉需要的时间：T+(n-1)t=T+(n-1)T/m

## 3.3主存储器与CPU的连接

### 1、连接原理

片选线CS，读写线WE（读为RD，写为WR）

![image-20240905143743311](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20240905143743311.png)

### 2、主存容量的拓展

（1）位拓展

地址线连到所有芯片，需要增加新的数据线连到新芯片

（2）字拓展

增加新地址线，通过**译码器**后连到所有芯片，数据线也要连到所有芯片

![image-20240905145330870](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20240905145330870.png)

（3）字位同时拓展

### 3、存储芯片的地址分配和片选

（1）线选法

高位地址线直接连到**片选端**

地址线信息为0时选中对应芯片

增加n个芯片需要n条地址线

（2）译码片选法

高位地址通过**译码器**连接到芯片地址端

增加n个芯片需要log~2~n条地址线

译码器可能有**使能端G**，信号为1时才工作，连接到CPU的**MREQ**

## 3.4外部存储器

### 1、磁盘存储器

磁头数->柱面数->扇区

最小读写单位：**扇区**

![image-20240905152213407](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20240905152213407.png)

### 2、性能指标

寻道时间：磁头移动到目的磁道的时间，经常取平均值

旋转时间：1/(2*转速)，经常取平均值

**存取时间**：寻道时间(题目给出)+旋转延迟时间(1/2*转速)+传输时间(扇区大小/传输速率)

### 3、磁盘阵列

RAID独立冗余磁盘阵列

措施：奇偶校验、海明纠错、磁盘镜像

效果：提高传输率、数据吞吐量、安全性、容错能力

### 4、固态硬盘

易磨损

## 3.5高速缓冲存储器

### 1、局部性原理

空间局部性：最近的未来要用到的信息，常常是存储空间临近的**数组**。

时间局部性：最近的未来要用到的信息，常常是**重复访问**的**程序**段（循环）。

### 2、cache基本原理

**cache总长**=有效位1位(1有效0无效)+标记位+行长

主存与cache之间以**块**为单位进行数据交换

主存中的块也称为**页/页面/页框**

cache中的块也称为**行**，行长是**数据的长度**不包括前面的标志那些

命中次数Nc

访问主存次数Nm

**命中率**H=Nc/(Nc+Nm)

**缺失率**M=1-H

访问一次cache需要的时间tc

访问一次主存需要的时间tm

**平均访问时间**t=Htc+(1-H)(tc+tm)

### 3、cache和主存的映射方式

（1）全相联映射

主存的每一块可装入cache的**任何位置**

标记位=主存块地址

需要依次查找对比标记，访问**最慢**

（2）直接相联映射

cache共m行

主存的第n行映射到cache的**n%m**行

标记位=主存块地址/m，即**少了log~2~m位**

替换时**直接换掉**对应地址的块

![image-20240906164453244](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20240906164453244.png)

（3）组相联映射

给cache分组

组内采用全相联映射，组间采用直接相联映射

主存的第n行映射到cache的**n%m组**

x路组相联映射=x个cache行为一组

### 4、cache中主存块的替换算法

（1）随机算法RAND

**随机**选择一块替换

不稳定

（2）先进先出算法FIFO

替换**最先调入**的块

不满足局部性

**抖动**现象：频繁换入换出

（2）近期最少使用算法LRU

维护一个**计数器**，记录多久没有被访问过

步骤：
命中行计数器清0，比其低的计数器+1
新装入自身清0，全部+1
换出最大的

### 5、cache的写策略

（1）写操作命中

**全写法**：同时写入cache和主存，写回更慢，经常增加一个**写缓存**

**回写法**：写入cache，当块**被换出**时写入主存，需要增加一个**脏位**

（2）写操作不命中

**写分配法**：把主存块调入cache，在cache中修改，与**回写法**一起使用

**非写分配法**：只更新主存，**不调入**cache，与**全写法**一起使用
