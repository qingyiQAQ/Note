# 第一章 计算机系统概述

## 计算机发展历程

计算机发展经历以下阶段：电子管计算机，晶体管计算机，集成电路计算机，超大规模集成电路计算机

摩尔定律（戈登摩尔）：当价格不变时,集成电路上可容纳的晶体管数量大约18～24个月翻一番.性能也将提升一倍。

集成电路生产：IC设计，IC制造，IC封测

## 计算机系统组成

### 计算机硬件系统

冯诺依曼结构计算机

基本思想：存储程序，程序控制。

冯诺依曼计算机组成：运算器，控制器，存储器，输入设备，输出设备，总线。

三个基本原则：**采用二进制逻辑**、**程序存储执行**（存储程序和程序控制）以及**计算机由五个部分组成**（运算器、控制器、存储器、输入设备、输出设备）

### 计算机软件系统

按功能分为：应用软件，系统软件

系统软件：操作系统，程序设计语言及语言处理程序（机器语言，汇编语言，高级语言），数据库管理系统，应用程序

## 计算机层次结构

6.高级语言层，5.汇编语言层，4.操作系统层（后三层为软件）

3.指令集架构层，2.微代码层，1.逻辑门层（前三层为硬件层）

![image-20230508145856288](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230508145856288.png)

## 计算机性能指标与评价

**字长**：CPU一次处理的数据位数，表示为T

影响计算精确度，影响数据的表示范围和精度

**主存容量**：主存能储存的最大信息量，表示为M*N

M储存单元数，N每个储存单元储存的二进制位数

例：8GB	M=8×20^30^	N=8

**时钟周期**：是计算机中最基本，最小的时间单位。在一个时钟周期内，CPU仅完成一个最基本的动作。是**主频**（时钟频率f）的倒数。

**CPI**：是指执行每条指令所需要的平均时钟周期数。

CPI=m/IC

m程序执行所需的时钟周期数

IC总指令条数

**CPU时间**：T~CPU~=m×T=CPI×IC×T

**IPC**：每个时钟周期CPU能执行指令条数，是CPI的倒数。

**MIPS**：每秒百万条指令。更大的单位有GIPS

MIPS=IC/(T~CPU~×10^6^)=f/CPI=IPC×f（f单位为MHz）

**MFLOPS**：每秒执行百万次浮点数运算次数，此外还有GFLOPS,TFLOPS,PFLOPS。

![image-20230508154539592](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230508154539592.png)

# 第二章 数据信息的表示

## 数据表示的作用

数据表示需要考虑：数据的类型，表示的范围和精度，储存和处理的代价，软件的可移植性

## 数值数据的表示

**真值**：用+-表示数据的正负。

## 数的机器码表示

1.**原码**：正数第一位为0，负数为1，其余不变。

2.**反码**：正数时原码与反码相同，负数时符号位不变，其余取反。

3.**补码**：原码取反加1。

若字长为n(包括符号位)，则负数补码[x]补=2^n^+x，正数补码即原码。

4.**变形补码**：也成双符号补码/模4补码

若字长为n(包括符号位)，则负数变形补码[x]补=2^n+1^+x，正数变形补码即原码。

5.**移码**：只用于定点整数的表示，用于表示浮点数的阶码。定义为：真值直接加上一个常值偏移量。

若字长为n(包括符号位)，则移码[x]补=2^n-1^+x。

是补码的符号位取反。

![image-20230613090337983](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230613090337983.png)

## 定点数表示

1.**定点小数**：小数点的位置固定在数据最高位之前，符号位之后。x0为符号位，x1到xn是尾数。

2.**定点整数**：小数点固定在最低数位之后的数。char,short,int,long都是定点整数。表示范围与机器字长与采用的机器数表示方法有关。

![image-20230613092249278](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230613092249278.png)

3.**定点数表示范围**：若计算机字长为n+1(包含符号位)

![image-20230613092501581](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230613092501581.png)

溢出：数据超出计算机能表示的范围。

精度溢出：数据不在刻度上。

## 浮点数的表示

1.**表示形式**：![image-20230613092636911](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230613092636911.png)

E为阶码(定点整数)，M为尾数(定点小数)

![image-20230613092755712](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230613092755712.png)

2.**浮点数表示范围**：

![image-20230613092938943](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230613092938943.png)

3.**浮点数的规格化**：使得尾数的真值最高位有效位为1。
一种是绝对值大于等于0.1，一种的绝对值大于等于1.0

4.**IEEE754浮点数标准**：主要包括32位单精度浮点数(float)和64位双精度浮点数(double)。

5.**IEEE单精度浮点数**：符号位S1位，阶码E8位，尾数M23位。双进度浮点数阶码E11位，尾数M52位。

![image-20230613103232373](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230613103232373.png)

E采用移码表示，偏移量为127![image-20230613104457467](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230613104457467.png)

当1<=E<=254，浮点数为规格化数，公式：![image-20230613104736720](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230613104736720.png)

当E=0，M！=0，浮点数为非规格化数，公式：![image-20230613104812496](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230613104812496.png)

6.**单精度浮点数与真值之间的转换**：

![image-20230613111402340](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230613111402340.png)

例题：

![image-20230613111412667](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230613111412667.png)

## 十进制数编码

1.**十进制整数**：

(1)BCD码：用4位二进制数表示0-9这10个数。

8421码：4位二进制数的权值分别为8,4,2,1。
2421码：4位二进制数的权值分别为2,4,2,1。
余3码：8421码+3。

![image-20230613112032926](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230613112032926.png)

(2)BID码：就是十进制的直接二进制表示。

(3)DPD码：利用10位二进制表示3位十进制。

![image-20230613112231857](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230613112231857.png)

2.**十进制浮点数**：

![image-20230613112843631](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230613112843631.png)

尾数不是定点小数而是定点整数
不需要规格化处理，同一个数有多种表示（保留原精度）

## 计算机中的数据类型

### 内容空缺

## 非数值数据的表示

### 内容空缺

1.**字符表示**：ASCII码
0-9	30H-39H
空格	20H
A-Z	41H-5AH
a-z	61H-7AH

2.**汉字编码**：GB2312国标码
采用矩阵表示，行为“区”，列为“位”，区位码

## 数据信息的校检

**校检码**：具有发现错误或纠正错误能力的数据编码。

![image-20230613114651353](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230613114651353.png)

**码距与检验**：
码距：两个编码对应二进制位不同的个数称为码距，又叫海明距离。
![image-20230613115005333](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230613115005333.png)

## 奇偶校验

**简单奇偶校验**

![image-20230613180624137](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230613180624137.png)

偶校验的编码规则是使编码中1的个数为偶数，奇校验相反。

检错：![image-20230613180725506](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230613180725506.png)

偶校验出错数据中1的个数为奇数，即不满足上述编码规则
只能检测奇数位错

**交叉奇偶校验**

将简单奇偶校验拓展为矩阵
可以检测所有奇数位错，所有双位错和所有3位错，大多数4位错（4个出错位位于4个顶点除外）

![image-20230613181515850](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230613181515850.png)

## 海明校验

1.**编码规则**：(1)原始数据信息被分成若干个偶校验组，每组设置一位偶校验位，每个数据位都会位于两个以上的校验组以提高检错率，所有校验组的检错位的值构成检错码。
(2）检错码值为0表示大概率无错误，不为0时检错码的值**表示出错位的位置**。

2.**校验位的位数**：![image-20230613181911258](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230613181911258.png)
原始信息k位，r个偶校验组

3.**编码分组规则**：

![image-20230613182225805](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230613182225805.png)

(7,4)码：

![image-20230613214520865](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230613214520865.png)

4.**拓展海明码**：为海明码增加一个总校验位P~all~，与总校验检错码G~all~。

![image-20230613214708388](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230613214708388.png)

例题：
![image-20230613215026746](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230613215026746.png)

## 循环冗余检验

**CRC码**

**运算基础**：

模2加减：与异或相同，1+-0=1,1+-1=0,0+-0=0,0+-1=1
模2乘法：列竖式，进行加法的时候按模2加减。
模2除法：
部分余数首位为1时,商上1，按模2运算减除数；
部分余数首位为0时，商上0，减0；
部分余数位数小于除数的位数时，该余数为最后余数。

**编码规则**：![image-20230613215605834](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230613215605834.png)

M(x)原数据，选择一个r+1位的生成多项式G(x)
M(x)左移r位，右侧补0，模2除法除以G(x)，得到商Q(x)，余数R(x)
得到的CRC码M(x)*2^r^+R(x)

**编码特性**：得到n位的CRC编码后模2除以生成多项式，所得余数即是出错的数据位置，如：0100代表第3位，0011代表1,2位同时出错。
![image-20230613220827088](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230613220827088.png)
![image-20230613220842633](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230613220842633.png)

**生成多项式**：由发送方与接收方共同约定，最高位与最低位必须为1，CRC码任何位发生错误后被生成多项式模2除后余数不应为0，不同位发生的错误余数不同，对余数做模2除法，应使余数循环。

**CRC检错性能**：

突发错误：几乎连续发生的一串错。
突发长度：出错的第一位到最后一位，不一定每一位都出错。

# 第三章 运算方法和运算器

## 计算机中的运算

**C语言中的位运算**：“&”，“|”，“~”，“^”，与或非异或
**C语言中的逻辑运算**：“&&”，“||”，“!”
**C语言中的移位运算**：“<<”，“>>”，左移右移
**C语言中的算术运算**：+-*/

## 定点加减法运算

1.**补码加法**：![image-20230614145327473](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230614145327473.png)
符号位的进位应当舍去
![image-20230614145610169](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230614145610169.png)

2.**补码减法**：![image-20230614145630860](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230614145630860.png)
![image-20230614145811959](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230614145811959.png)

## 溢出检测

**根据操作数和运算结果的符号位是否一致进行检测**
![image-20230614150352218](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230614150352218.png)
正正得负，负负得正时溢出
如果是x-y代入公式Yf代入的是-y的符号位

**根据运算过程中最高数据位的进位与符号位的进位是否一致进行检测**
![image-20230614150618804](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230614150618804.png)
最高位进位信号Cd，符号位进位信号Cf

**利用变形补码的符号位进行检测**
正数符号位11，负数符号位00，运算结果为01是上溢，运算结果为10是下溢，其余无溢出。
![image-20230614150927176](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230614150927176.png)
Sf1和Sf2分别是运算结果的1,2位。

## 加减法的逻辑实现

**全加器**：带进位的一位加法器。
3个输入：相加数X~i~，Y~i~，低位进位输入C~i~。
2个输出：和数S~i~，高位进位输出C~i+1~。
![image-20230614151416513](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230614151416513.png)
![image-20230614151426944](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230614151426944.png)
![image-20230614151458538](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230614151458538.png)
和数延迟为6T，进位延迟为2T(左图，右图进位延迟5T)

**半加器**：没有进位输入。
![image-20230614151828187](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230614151828187.png)
时间延迟为3T

**多位串行加法器**：也称**行波进位加法器**，将n个全加器的进位链串联即可得到n位串行加法器。
可用于有符号数运算和无符号数运算
C~n~的时间延迟为(2n+3)T，S~n-1~的时间延迟为(2n+4)T，Overflow信号的时间延迟为(2n+6)T。

**可控加减法电路**：只需要将减数Y的补码再次求补后送入加法器即可实现减法运算
![image-20230614153956465](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230614153956465.png)![image-20230614153810015](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230614153810015.png)

**先行进位加法器**：也称快速加法器，并行加法器。
进位生成函数：![image-20230614154740562](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230614154740562.png)
进位传递函数：![image-20230614154719614](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230614154719614.png)![image-20230614154336673](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230614154336673.png)
4位先行进位电路：![image-20230614154414567](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230614154414567.png)
成组进位生成函数：![image-20230614154457992](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230614154457992.png)
成组进位传递函数：![image-20230614154513534](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230614154513534.png)

## 定点乘法运算

**原码一位乘法**：
乘积符号：![image-20230614154954762](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230614154954762.png)
乘积数值：![image-20230614155007279](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230614155007279.png)


# 第四章 存储系统

## 存储器概述

按存储介质分类：磁存储器，半导体存储器，光存储器

按存取方式分类：随机存储器RAM，顺序存储器SAM，直接存储器DAM

按信息可改写性：读写存储器，只读存储器ROM

按信息可保存性：易失性存储器（断电后信息丢失），非易失性存储器

按功能和存储速度：寄存器存储器，高速缓存存储器，主存储器，外存储器。

存储器计数指标：1.存储容量。2.存取速度（存取时间（访问时间），存取周期（两次访问的间隔），存储器带宽（单位时间内存储器所能传输的信息量））

层次结构：

![image-20230508160143230](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230508160143230.png)

主存基本结构

![image-20230515143914514](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230515143914514.png)

**主存中数据的存放**

1.**存储字长与数据字长**

存储字长：主存的一个（存储单元所存储的二进制位数

数据字长：计算机一次能处理的二进制位数

2.地址访问模式：字节（8位），半字（16位），字（32位）

3.**大端和小端方式**：

小端方式：存储器的低字节地址单元中存放的是数据的最低字节。

大端方式：与小端相反。

4.**数据的边界对齐**：

(1)双字数据起始字节地址的最末3位为000，地址是8的整数倍。

(2)单字数据起始字节地址的最低两位为00，地址是4的整数倍。

(3)半字数据起始字节地址的最低一位为0，地址是2的整数倍。

(4)单字节数据不存在边界对齐问题(主存按字节编址)。

## 半导体储存器

特点：存取速度快，体积小，性能可靠。

### 静态MOS存储器

1.**静态MOS单元**

MOS：Metal Oxide Semiconductor Field Effect Transistor，金属氧化物半导体场效应晶体管，简称场效应管。

也称静态随机存取存储器，(**SRAM**: Static Random Access Memory)

存储单元：最小的存储单位，储存一个二进制信息。

具有两种稳定状态。两种稳定状态经外部信号控制可以相互转换。经控制后能读出其中的信息。无外部原因，其中的信息能长期保存。

(1)6管MOS存储单元

工作管，负载管，门控管

2.**存储单元拓展**

译码器：又称最小项发生器

单译码结构，双译码结构：单译码结构是一维的。双译码结构是二维的。

3.静态MOS存储器的结构：由存储体，地址译码电路，I/O电路和控制电路等组成。

### 动态MOS存储器

也称动态随机存取存储器，(**DRAM**: Dynamic Random Access Memory)

1.**单管动态MOS存储单元**：仅含一个MOS管和一个电容，存放一位二进制数

**特点**：
(1)存储密度高
(2)因为电容的充放电过程较慢，因此单管DRAM的**读写速度比SRAM慢**
(4)单管DRAM读出时，会引起电容电荷的减少，从而破坏原有数据，为避免数据丢失，在**读出后需要将数据重新写入**，该过程称为**数据恢复**（再生）
(4)因为电容上的电荷会逐渐泄漏，数据只能保存较短的时间，为避免数据丢失，必须定期采用类似读操作的方式对存储单元**补充电荷**，这个过程称为**刷新**

**读操作流程**：预充操作，访问操作，信号检测，数据恢复，数据输出。

2.**动态MOS存储的刷新**

**最大刷新周期**：信息存储到数据丢失之前的这段时间。

刷新**按行进行**。

刷新时不能响应CPU的访问，解决方法：集中刷新，分散刷新，异步刷新

### 只读存储器

信息只能读出、不能随意写入的存储器称为只读存储器，记为**ROM**。

按照制造工艺的不同，可将ROM分为:掩膜式只读存储器**MROM**、可编程只读存储器**PROM**、可擦除可编程只读存储器**EPROM**、电可擦除可编程只读存储器**EEPROM**，以及**闪存**,共5种。

MROM：只能读出,不能修改，灵活性较差,但信息固定不变，可靠性高。
PROM：只能改写一次，灵活性还是欠佳。
EPROM：是一种可多次写入的ROM。其写入的信息可长期保存，当不需要这些信息或希望进行修改时，可擦除后再进行重写。
EEPROM：可以精准地删除某一存储单元，而不是一次性擦除芯片上的所有数据。
闪存：是一种快速擦写、非易失性存储器，可以在线进行擦除和重写。

## 主存的组织与CPU的连接

**存储器的拓展**

1.**位拓展**：又称字长拓展，数据总线拓展。

例如，可以利用32个256Kx1位的SRAM芯片，构成1个256Kx32位的存储器。
地址线：18根（2^18^=256K）
数据线：32根
控制线：MREQ#（相当于/MREQ）连接到每个SRAM芯片的CS端（片选信号）；R/W#（相当于-R/W）连接到每个SRAM芯片的WE端（读写控制信号）

![image-20230616232732818](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230616232732818.png)

2.**字拓展**：又称容量扩展或地址总线扩展。

例如，可以利用8个256Kx8位的SRAM芯片，构成1个2Mx8位的存储器。
地址线：21根（2^21^=2M）其高位部分（A20～A18）连接3-8译码器的输入，低位部分（A17～A0）同时连接到每个SRAM芯片的地址线A（18根）
数据线：8根
控制线：MREQ#连接到3-8译码器的OE端；R/W#连接到每个存储器芯片的WE端

![image-20230616233237617](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230616233237617.png)

3.**字位同时拓展**：

例如，可以利用32个256Kx8位的SRAM芯片，构成1个2Mx32位的存储器
地址线：21根（2^21^=2M），其高位部分（A20～A18）连接到3-8译码器的输入，低位部分（A17～A0）同时连接到每个SRAM芯片的地址线A（18根）
数据线：32根，分为4组（D31～D24；D23～D16；D15～D8；D7～D0），分别连接到每个SRAM芯片的数据线D（8根）
控制线：MREQ#连接到3-8译码器的OE端；R/W#连接到每个SRAM芯片的WE端

![image-20230616233621438](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230616233621438.png)

## 并行储存系统

1.**双端口存储器**：双端口存储器是指同一个存储器具有两组相互独立的端口，每个端口均有各自独立的数据端口、地址端口、读写控制端口、片选端口等，每个端口可独立地进行读写操作。
并行读写，冲突处理

2.**单体多字存储器**：多个存储模块共享地址总线，按同一地址并行访问不同存储模块的同一单元。

3.**多体交叉存储器**

**高位多体交叉存储器**的结构与存储器字扩展完全相同，也称为顺序编址模式；高位地址（A20～A18）经过译码器用于选择不同的存储体，低位地址（A17～A0）同时送各个存储体。
![image-20230618143253920](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230618143253920.png)

**低位多体交叉存储器**的结构与存储器字扩展也基本相同，只是低位地址（左下角图中的A2～A0）经过译码器用于选择不同的存储体，而高位地址（A20～A3）同时送各个存储体；低位多体交叉也称为**交叉编址模式**
![image-20230618143321429](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230618143321429.png)

![image-20230618143440461](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230618143440461.png)

## 高速缓冲储存器

SRAM相对DRAM速度更快，但其容量有限，成本也更高，功耗较大，为了进一步提升CPU访问主存的性能，通常会在CPU 与主存之间增加一个隐藏的小容量的快速的SRAM，称为**cache**。

将主存中经常访问或即将访问的数据的副本调度到小容量的SRAM中。

**程序局部性**：程序局部性是指程序在执行时呈现出局部性规律，即在一段时间内，整个程序的执行仅限于程序中的某一部分，而执行程序所需的指令和数据也仅局限于某个存储区域内。具体来说，局部性又表现为**时间局部性**和**空间局部性**。

**时间局部性**是指当程序访问一个存储位置时，该位置在未来可能会被多次访问，程序的**循环结构**和**调用过程**就很好地体现了时间局部性。

**空间局部性**是指一旦程序访问了某个存储单元，则其**附近的存储单元**也即将被访问。计算机**指令代码**、**数组**、**结构体元素**通常在主存中顺序存放，对应的数据访问具有较强的空间局部性。

**cache基本概念**

1.**数据命中**：数据在cache中。
2.**命中访问时间**：命中时的数据访问时间。包括：查找时间和cache访问时间。
3.**数据缺失**：数据不在cache中。
4.**缺失补偿**：将缺失数据从主存调入cache中的访问时间。

5.**命中率**：
![image-20230618144240801](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230618144240801.png)
6.**缺失率**：1-h
7.**平均访问时间**：
![image-20230618144427715](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230618144427715.png)
8.**访问效率**：
![image-20230618144458864](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230618144458864.png)

**cache读、写流程与关键技术**

1.**读**：
![image-20230618145327206](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230618145327206.png)

2.**写**：
![image-20230618145351938](C:\Users\CC507\AppData\Roaming\Typora\typora-user-images\image-20230618145351938.png)
**写回策略**：只写到cache，不写到主存。
**写穿策略**：写到cache而且写到主存。
**脏数据**：写回策略导致cache与主存的数据不一致，cache中的数据叫脏数据。
**写分配法**：将地址为WA的主存块调入cache中，再进行数据写入cache的操作。否则直接写入主存。
**替换**：cache已经满了，需要替换掉cache的某一块。

3.**关键技术**：

(1)**数据查找**：即如何快速查找数据是否在cache中？如果查找到，则为命
中，否则为缺失；通常采用**相联存储器**以提高数据查找的速度。

(2)**地址映射**：主存中的数据块应如何放置到cache中？是任意放置，还是
按照一定的规则（地址映射策略）放置？不同的地址映射策略会对cache的性能及硬件成本带来影响。

(3)**替换策略**：在将主存数据块放置到cache中时，如果cache满了，则需要
将cache中的某个数据块替换掉，不同的替换策略（替换算法）会对cache命中率产生影响。

(4)**写入策略**：在cache的写入操作时，如何保证cache与主存数据的一致性，通常有写回和写穿两种策略。

**相联存储器**：（**CAM**）：Content Addressable Memory

一种**按内容进行访问**的存储器。

输入检索关键字key，输出对应的值value。

**地址映射**：将主存地址空间映射到cache地址空间，即把主存的程序快或者数据快载入cache块的规则。

(1)**全相联映射**：主存的某一块可以映射到cache的任意块中。

cache的利用率高，冲突率低，硬件成本高，替换策略和算法复杂。

(2)**直接相联映射**：主存的某一块只能映射到cache的固定块中。

cache的利用率低、命中率低，冲突率高，硬件成本低，无须使用复杂的替换算法，直接替换冲突的数据块即可。

(3)**组相联映射**：主存的某一块只能映射到cache的固定组中，在该组中可以映射到任意块中。

## 虚拟储存器

